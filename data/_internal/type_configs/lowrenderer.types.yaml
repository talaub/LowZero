module: LowRenderer
namespace:
  - Low
  - Renderer
dll_macro: LOW_RENDERER_API
types:
  RenderFlow:
    private_make: true
    header_imports:
      - LowRendererInterface.h
      - LowRendererResourceRegistry.h
      - LowRendererMesh.h
      - LowUtilYaml.h
    source_imports:
      - LowRendererComputeStep.h
      - LowRendererGraphicsStep.h
    properties:
      context:
        type: Interface::Context
        handle: true
        private_setter: true
        private_getter: true
      dimensions:
        type: Math::UVector2
        no_setter: true
      output_image:
        type: Resource::Image
        handle: true
      steps:
        type: Util::List<Util::Handle>
      resources:
        type: ResourceRegistry
        no_setter: true
      camera_position:
        type: Math::Vector3
      camera_rotation:
        type: Math::Quaternion
      camera_fov:
        type: float
      camera_near_plane:
        type: float
      camera_far_plane:
        type: float
    functions:
      make:
        static: true
        return_type: RenderFlow
        return_handle: true
        parameters:
          - name: name
            type: Util::Name
          - name: context
            type: Interface::Context
            handle: true
          - name: config
            type: Util::Yaml::Node
      execute:
        return_type: void
      update_dimensions:
        return_type: void
        parameters:
          - name: dimensions
            type: Math::UVector2
    
  ComputeStep:
    private_make: true
    header_imports:
      - LowRendererInterface.h
      - LowRendererResourceRegistry.h
      - LowRendererComputeStepConfig.h
      - LowRendererComputePipeline.h
      - LowRendererRenderFlow.h
      - LowUtilYaml.h
    properties:
      resources:
        type: Util::Map<RenderFlow, ResourceRegistry>
        no_setter: true
      config:
        type: ComputeStepConfig
        handle: true
        private_setter: true
      pipelines:
        type: Util::List<Interface::ComputePipeline>
        no_setter: true
      signatures:
        type: Util::List<Interface::PipelineResourceSignature>
        no_setter: true
      context:
        type: Interface::Context
        handle: true
        private_setter: true
        private_getter: true
    functions:
      make:
        static: true
        return_type: ComputeStep
        return_handle: true
        parameters:
          - name: name
            type: Util::Name
          - name: context
            type: Interface::Context
            handle: true
          - name: config
            type: ComputeStepConfig
            handle: true
      prepare:
        return_type: void
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true
      execute:
        return_type: void
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true
      update_dimensions:
        return_type: void
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true
      prepare_signature:
        return_type: void
        private: true
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true

  ComputeStepConfig:
    private_make: true
    header_imports:
      - LowRendererFrontendConfig.h
    properties:
     resources:
       type: Util::List<ResourceConfig> 
       no_setter: true
     pipelines:
       type: Util::List<ComputePipelineConfig>
       no_setter: true
    functions:
      make:
        static: true
        return_type: ComputeStepConfig
        return_handle: true
        parameters:
          - name: name
            type: Util::Name
          - name: node
            type: Util::Yaml::Node

  GraphicsStepConfig:
    private_make: true
    header_imports:
      - LowRendererFrontendConfig.h
    source_imports:
      - LowUtilString.h
    properties:
     resources:
       type: Util::List<ResourceConfig> 
       no_setter: true
     pipelines:
       type: Util::List<GraphicsPipelineConfig>
       no_setter: true
     rendertargets:
       type: Util::List<PipelineResourceBindingConfig>
       no_setter: true
    functions:
      make:
        static: true
        return_type: GraphicsStepConfig
        return_handle: true
        parameters:
          - name: name
            type: Util::Name
          - name: node
            type: Util::Yaml::Node

  GraphicsStep:
    private_make: true
    header_imports:
      - LowRendererInterface.h
      - LowRendererResourceRegistry.h
      - LowRendererGraphicsStepConfig.h
      - LowRendererGraphicsPipeline.h
      - LowRendererRenderObject.h
      - LowRendererRenderFlow.h
      - LowRendererBuffer.h
      - LowUtilYaml.h
    properties:
      resources:
        type: Util::Map<RenderFlow, ResourceRegistry>
        no_setter: true
      config:
        type: GraphicsStepConfig
        handle: true
        private_setter: true
      pipelines:
        type: Util::Map<RenderFlow, Util::List<Interface::GraphicsPipeline>>
        no_setter: true
      renderobjects:
        type: Util::Map<Util::Name, Util::Map<Mesh, Util::List<RenderObject>>>
        no_setter: true
      renderpasses:
        type: Util::Map<RenderFlow, Interface::Renderpass>
        no_setter: true
      context:
        type: Interface::Context
        handle: true
        private_setter: true
        private_getter: true
      signatures:
        type: Util::Map<RenderFlow, Interface::PipelineResourceSignature>
        no_setter: true
        private_getter: true
      object_matrix_buffers:
        type: Util::Map<RenderFlow, Resource::Buffer>
        no_setter: true
        private_getter: true
    functions:
      make:
        static: true
        return_type: GraphicsStep
        return_handle: true
        parameters:
          - name: name
            type: Util::Name
          - name: context
            type: Interface::Context
            handle: true
          - name: config
            type: GraphicsStepConfig
            handle: true
      prepare:
        return_type: void
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true
      execute:
        return_type: void
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true
          - name: projectionMatrix
            type: Math::Matrix4x4
          - name: viewMatrix
            type: Math::Matrix4x4
      register_renderobject:
        return_type: void
        parameters:
          - name: renderObject
            type: RenderObject
            handle: true
      update_dimensions:
        return_type: void
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true
      create_renderpass:
        return_type: void
        private: true
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true
      create_pipelines:
        return_type: void
        private: true
        parameters:
          - name: renderFlow
            type: RenderFlow
            handle: true
          - name: updateExisting
            type: bool

  Texture2D:
    private_make: true
    header_imports:
      - LowRendererImage.h
    properties:
      image:
        type: Resource::Image
        private_setter: true
    functions:
      make:
        static: true
        return_type: Texture2D
        return_handle: true
        parameters:
          - name: name
            type: Util::Name
          - name: params
            type: Backend::ImageResourceCreateParams

  Mesh:
    properties:
      vertex_buffer_start:
        type: uint32_t
      vertex_count:
        type: uint32_t
      index_buffer_start:
        type: uint32_t
      index_count:
        type: uint32_t

  RenderObject:
    header_imports:
      - LowMathVectorUtil.h
      - LowRendererMesh.h
      - LowRendererMaterial.h
    properties:
      mesh:
        type: Mesh
        handle: true
      material:
        type: Material
        handle: true
      world_position:
        type: Math::Vector3
      world_rotation:
        type: Math::Quaternion
      world_scale:
        type: Math::Vector3

  MaterialType:
    header_imports:
      - LowRendererFrontendConfig.h
    properties:
      gbuffer_pipeline:
        type: GraphicsPipelineConfig

  Material:
    header_imports:
      - LowRendererMaterialType.h
    properties:
      material_type:
        type: MaterialType
        handle: true
